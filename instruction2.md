# 開発方針および技術スタック定義書

あなたは熟練したフルスタックエンジニアおよびアーキテクトです。
現在開発中の「森林管理Androidアプリ」について、以下の技術スタックと方針に基づいて設計・実装を行ってください。
これまでの経緯に関わらず、今後はこの構成を「正」としてプロジェクトを進めます。

## 1. プロジェクト概要
- **目的**: 森林情報の管理、調査業務の効率化
- **主要な制約**:
    - 個人開発のため、初期投資0円、ランニングコストもミニマムに抑える
    - 将来的な拡張性（iOS対応、Web管理画面化）を担保する
- **重要課題**: 山間部の電波圏外エリアでの利用（オフラインファースト）

## 2. 技術スタック（Tech Stack）

### フロントエンド（Mobile App）
- **Framework**: **Flutter** (Dart)
    - 理由: Android/iOSの単一コードベース化、強力な型安全性、豊富なエコシステム。
- **State Management**: Riverpod (推奨) または Provider
    - 拡張性とテスタビリティの確保。
- **Map Library**: **flutter_map**
    - タイルプロバイダ: OpenStreetMap または 国土地理院地図（標準地図/淡色地図/写真）
    - 理由: 完全無料での利用、Google Maps APIの従量課金回避。

### バックエンド & データベース
- **Platform**: **Supabase**
- **Database**: PostgreSQL
- **Extension**: **PostGIS** (必須有効化)
    - 理由: 森林エリア（ポリゴン）や樹木位置（ポイント）などの地理空間データをSQLで高速に処理するため。NoSQLではなくRDBを採用する最大の理由。
- **Auth**: Supabase Auth (Email/Password)

## 3. アーキテクチャ要件

### オフライン・データ同期戦略 (Offline-First)
森林内では通信ができないことを前提とした設計にしてください。
1.  **Local First**: データの読み書きは常にローカルDB（Isar または SQLite/Drift）に対して行う。
2.  **Sync Mechanism**: 通信回復時に、バックグラウンドでローカルDBとSupabase間の差分同期を行うロジックを実装する。

### データモデル方針
- 地理情報は `latitude`, `longitude` のカラムだけでなく、PostGISの `GEOGRAPHY(POINT)` 型などを活用し、将来的なGIS解析（面積計算、近傍検索）に耐えうる設計とする。

## 4. 今後のアクション
以降のコード生成、設計相談はすべて上記スタックを前提に行ってください。
まず手始めに、このスタックに基づいた **「プロジェクトのディレクトリ構成」** と **「主要なテーブル定義（Supabase SQL）」** を提案してください。